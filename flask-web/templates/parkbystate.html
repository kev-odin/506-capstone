<!DOCTYPE html>
<html>
  {% extends "base.html" %} {% set active_page = 'parkbystate' %} {% block title
  %} Parkbystate {% endblock %} {% block header %}

  <style>
    #map {
      height: 400px;
      width: 100%;
    }
  </style>
  <script>
    var map;
    var InforObj = [];
    var centerCords = {
        lat: 41.500000,
        lng: -100.000000
    };

    var markersOnMap = [
      // why this for loop report bugs
      {% for park in myData.values() %}
        {
            placeName: "{{park['fullName']}}",
            text: "{{park['address']}}",
            LatLng: [{
                lat: {{park['latitude']}},
                lng: {{park['longitude']}}
            }]
        },
        {% endfor %}
        // why this for loop report bugs
    ];

    window.onload = function () {
        initMap();
    };

    function addMarkerInfo() {
        for (var i = 0; i < markersOnMap.length; i++) {
            var contentString = '<div id="content"><h5>' + markersOnMap[i].placeName +
              '</h5><p>' + markersOnMap[i].text+'</p></div>';

            const marker = new google.maps.Marker({
                position: markersOnMap[i].LatLng[0],
                map: map
            });

            const infowindow = new google.maps.InfoWindow({
                content: contentString,
                maxWidth: 200
            });

            marker.addListener('click', function () {
                closeOtherInfo();
                infowindow.open(marker.get('map'), marker);
                InforObj[0] = infowindow;
            });
            marker.addListener('mouseover', function () {
                closeOtherInfo();
                infowindow.open(marker.get('map'), marker);
                InforObj[0] = infowindow;
            });
            marker.addListener('mouseout', function () {
                closeOtherInfo();
                infowindow.close();
                InforObj[0] = infowindow;
            });
        }
    }

    function closeOtherInfo() {
        if (InforObj.length > 0) {
            /* detach the info-window from the marker ... undocumented in the API docs */
            InforObj[0].set("marker", null);
            /* and close it */
            InforObj[0].close();
            /* blank the array */
            InforObj.length = 0;
        }
    }

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 3,
            center: centerCords
        });
        addMarkerInfo();
    }
  </script>
  {% endblock %} {% block content %}
  <!-- The below is copied from hw3 birthday search home.html -->
  <div class="d-flex align-items-center justify-content-center">
    <form method="post">
      {{ form.csrf_token }}
      <div class="mb-3">
        <fieldset class="form-field">
          {{ form.state.label(class="form-label") }} {{
          form.state(class="form-control") }}
        </fieldset>
      </div>

      {{ form.submit(class="btn btn-primary") }}
    </form>
  </div>

  <!-- The above is copied from hw3 birthday search home.html -->

  <div class="accordion" id="accordionPanelsStayOpenExample">
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingOne">
        <button
          class="accordion-button"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#panelsStayOpen-collapseOne"
          aria-expanded="false"
          aria-controls="panelsStayOpen-collapseOne"
        >
          Accordion Item #1
        </button>
      </h2>
      <div
        id="panelsStayOpen-collapseOne"
        class="accordion-collapse collapse"
        aria-labelledby="panelsStayOpen-headingOne"
      >
        <div class="accordion-body">
          <h3>National park Maps</h3>
          <!--The div element for the map -->
          <div id="map"></div>

          <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-Ydd4QD8Fz6hUnLwHN1Hs9_IvGyrX68k"></script>
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#panelsStayOpen-collapseTwo"
          aria-expanded="false"
          aria-controls="panelsStayOpen-collapseTwo"
        >
          Accordion Item #2
        </button>
      </h2>
      <div
        id="panelsStayOpen-collapseTwo"
        class="accordion-collapse collapse"
        aria-labelledby="panelsStayOpen-headingTwo"
      >
        <div class="accordion-body">
          <strong>This is the second item's accordion body.</strong> It is
          hidden by default, until the collapse plugin adds the appropriate
          classes that we use to style each element. These classes control the
          overall appearance, as well as the showing and hiding via CSS
          transitions. You can modify any of this with custom CSS or overriding
          our default variables. It's also worth noting that just about any HTML
          can go within the <code>.accordion-body</code>, though the transition
          does limit overflow.
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingThree">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#panelsStayOpen-collapseThree"
          aria-expanded="false"
          aria-controls="panelsStayOpen-collapseThree"
        >
          Accordion Item #3
        </button>
      </h2>
      <div
        id="panelsStayOpen-collapseThree"
        class="accordion-collapse collapse"
        aria-labelledby="panelsStayOpen-headingThree"
      >
        <div class="accordion-body">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">fullName</th>
                <th scope="col">latLong</th>
                <th scope="col">description</th>
              </tr>
            </thead>

            <tbody>
              {% for park in myData.values() %}
              <tr>
                <td class="align-middle">{{ park['fullName'] }}</td>
                <td class="align-middle">
                  <img src= {{ park['images'][0]['url'] }} class="img-thumbnail"
                  style="max-height:50px;max-width:50px;"> {{park['latLong']}}
                </td>
                <td class="align-middle">{{ park['description']}}</td>
              </tr>

              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  {% endblock %}
</html>
